digraph RailsFlowMap {
  rankdir=TB;
  node [shape=box];

  subgraph cluster_models {
    label="Models";
    style=filled;
    color=lightgrey;
    node [style=filled,color=pink];
    model_user [label="User"];
    model_post [label="Post"];
    model_comment [label="Comment"];
  }

  subgraph cluster_controllers {
    label="Controllers";
    style=filled;
    color=lightblue;
    node [style=filled,color=lightblue];
    controller_users [label="UsersController",shape=component];
    controller_posts [label="PostsController",shape=component];
  }

  subgraph cluster_actions {
    label="Actions";
    style=filled;
    color=lightgreen;
    node [style=filled,color=lightgreen,shape=ellipse];
    action_users_index [label="UsersController#index"];
    action_posts_index [label="PostsController#index"];
  }

  model_user -> model_post [label="posts", style=solid, arrowhead=crow];
  model_user -> model_comment [label="comments", style=solid, arrowhead=crow];
  model_post -> model_user [label="user", style=solid, arrowhead=normal];
  model_post -> model_comment [label="comments", style=solid, arrowhead=crow];
  model_comment -> model_user [label="user", style=solid, arrowhead=normal];
  model_comment -> model_post [label="post", style=solid, arrowhead=normal];
  route_users_index -> action_users_index [];
  route_posts_index -> action_posts_index [];
  controller_users -> action_users_index [style=dashed, color=gray];
  controller_posts -> action_posts_index [style=dashed, color=gray];
  action_users_index -> service_user [label="fetch_users"];
  action_posts_index -> service_post [label="list_posts"];
  service_user -> model_user [label="User.all"];
  service_post -> model_post [label="Post.published"];
  service_post -> model_user [label="includes(:user)"];
}