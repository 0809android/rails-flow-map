digraph RailsFlowMap {
  rankdir=TB;
  node [shape=box];

  subgraph cluster_models {
    label="Models";
    style=filled;
    color=lightgrey;
    node [style=filled,color=pink];
    user [label="User"];
    post [label="Post"];
    comment [label="Comment"];
  }

  subgraph cluster_controllers {
    label="Controllers";
    style=filled;
    color=lightblue;
    node [style=filled,color=lightblue];
    users_controller [label="UsersController",shape=component];
    posts_controller [label="PostsController",shape=component];
  }

  subgraph cluster_actions {
    label="Actions";
    style=filled;
    color=lightgreen;
    node [style=filled,color=lightgreen,shape=ellipse];
    users_index [label="UsersController#index"];
    posts_create [label="PostsController#create"];
  }

  post -> user [style=solid, arrowhead=normal];
  comment -> user [style=solid, arrowhead=normal];
  comment -> post [style=solid, arrowhead=normal];
  users_controller -> users_index [style=dashed, color=gray];
  posts_controller -> posts_create [style=dashed, color=gray];
  users_index -> user_service [label="fetch_active_users"];
  user_service -> user [label="User.active"];
  route_users -> users_index [];
  route_posts -> posts_create [];
}